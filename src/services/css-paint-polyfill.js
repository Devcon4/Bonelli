!function(){function e(e,t){var n=document.createElement("iframe");n.style.cssText="position:absolute; left:0; top:-999px; width:1px; height:1px;",t.appendChild(n);var r=n.contentWindow,i=r.document,o="var window,$hook";for(var a in r)a in e||"eval"===a||(o+=",",o+=a);for(var s in e)o+=",",o+=s,o+="=self.",o+=s;var l=i.createElement("script");l.appendChild(i.createTextNode('function $hook(self,console) {"use strict";\n\t\t'+o+";return function() {return eval(arguments[0])}}")),i.body.appendChild(l),this.exec=r.$hook(e,console)}function t(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)},n.open("GET",e,!0),n.send()}function n(e,t,n){Object.defineProperty?Object.defineProperty(e,t,n):e[t]=n.get()}var r;window.CSS||(window.CSS={}),"paintWorklet"in window.CSS||n(window.CSS,"paintWorklet",{get:function(){return r||(r=new G)}});var i="css-paint-polyfill",o=document.createElement(i);o.style.cssText="display: none;",document.documentElement.appendChild(o);var a=document.createElement("style");a.id=i,a.$$isPaint=!0,o.appendChild(a);var s=a.sheet,l=o.style,c=[],u=/(paint\(|-moz-element\(#paint-|-webkit-canvas\(paint-|[('"]blob:[^'"#]+#paint=|[('"]data:image\/paint-)/,p="getCSSCanvasContext"in document,d=(l.backgroundImage="-moz-element(#"+i+")")===l.backgroundImage,h="function"==typeof Promise,f=Element.prototype.attachShadow;l.cssText="";var v=window.requestAnimationFrame||setTimeout,m=h?Promise.prototype.then.bind(Promise.resolve()):setTimeout,g=function(){return window.devicePixelRatio||1},y={},b={},$=0;function w(e){var t=e.bit^=1;return e.instances[t]||(e.instances[t]=new e.Painter)}function P(e,t){var n=e.cssText;!0===t.isNew&&u.test(n)&&n!==(n=E(n))&&(e=C(e,n));var r,i,o,a=e.selectorText,s=V(e.style);if(r=null==t.counters[a]?t.counters[a]=1:++t.counters[a],null!=b[i="sheet"+t.sheetId+"\n"+a+"\n"+r]){if((o=b[i]).selector===a)return o.rule=e,void(o.cssText!==s&&t.toProcess.push(o));t.toRemove.push(o)}else o=b[i]={key:i,selector:a,cssText:s,properties:{},rule:e},t.toProcess.push(o.selector)}function S(e,t){t(e);for(var n=e.firstElementChild;n;)S(n,t),n=n.nextElementSibling}function x(){for(var e=[].concat([].slice.call(document.styleSheets),[].slice.call(document.querySelectorAll("* *")).filter(function(e){return e.shadowRoot}).flatMap(function(e){return[].slice.call(e.shadowRoot.styleSheets)})),t={toProcess:[],toRemove:[],counters:{},isNew:!1,sheetId:null},n=0;n<e.length;n++){var r=e[n].ownerNode;r.$$isPaint||(t.sheetId=r.$$paintid,t.isNew=null==t.sheetId,t.isNew&&(t.sheetId=r.$$paintid=++$,!1===k(r))||R(r.sheet,P,t))}for(var i=t.toRemove.length;i--;)delete b[t.toRemove[i].key];t.toProcess.length>0&&function(e){try{for(var t=document.querySelectorAll(e),n=0;n<t.length;n++)I(t[n])}catch(e){}}(t.toProcess.join(", "))}function R(e,t,n){var r=[[0,e.cssRules]],i=r[0],o=i[1];if(o)for(var a=0;r.length>0;a++)if(a>=o.length){r.pop();var s=r.length;s>0&&(o=(i=r[s-1])[1],a=i[0])}else{i[0]=a;var l=o[a];if(1===l.type){var c=t(l,n);void 0!==c&&(n=c)}else l.cssRules&&l.cssRules.length>0&&r.push([0,l.cssRules])}return n}function C(e,t){for(var n=e.parentStyleSheet,r=e.parentRule,i=(r||n).cssRules,o=i.length-1,a=0;a<=o;a++)if(i[a]===e){(r||n).deleteRule(a),o=a;break}if(null!=t){if(r){var s=r.appendRule(t);return r.cssRules[s]}return n.insertRule(t,o),n.cssRules[o]}}function k(e){if(!e.$$isPaint){if(e.href)return t(e.href,function(e){return function(t){var n=document.createElement("style");if(n.disabled=!0,n.$$paintid=++$,n.appendChild(document.createTextNode(E(t))),document.contains(e))(document.head||document.createElement("head")).appendChild(n);else for(var r=e;r;){if(!r.parentNode){r.appendChild(n);break}r=r.parentNode}var i,o=[];for(R(n.sheet,T,o);i=o.pop();)C(i,null);x(),n.disabled=!1}}(e)),!1;for(var n=e.childNodes.length;n--;){var r=e.childNodes[n].nodeValue,i=E(r);i!==r&&(e.childNodes[n].nodeValue=i)}}}function T(e,t){u.test(e.cssText)||t.push(e)}function E(e){return e.replace(/(;|,|\b)paint\s*\(\s*(['"]?)(.+?)\2\s*\)(;|,|!|\b)/g,"$1url(data:image/paint-$3,=)$4")}var O,N,L=[];function I(e){!0!==e.$$paintPending&&(e.$$paintPending=!0,-1===L.indexOf(e)&&1===L.push(e)&&m(j))}function j(){for(var e;e=L.pop();)U(e)}function D(e,t,n){for(var r=e.length,i=function(){--r||t.apply(null,n||c)},o=0;o<e.length;o++){var a=new Image;a.onload=i,a.onerror=onerror,a.src=e[o]}}function A(e){var t=e.$$paintId;return null==t&&(t=e.$$paintId=++z),t}function M(e){var t=e.$$paintRule,n=A(e);if(null==t)if(e.hasAttribute("data-css-paint")||e.setAttribute("data-css-paint",n),document.contains(e)){var r=s.insertRule('[data-css-paint="'+z+'"] {}',s.cssRules.length);t=e.$$paintRule=s.cssRules[r]}else for(var o=e;o;){if(!o.parentNode){var l=o.querySelector("#"+i);l||(l=o.appendChild(a));var c=l.sheet.insertRule('[data-css-paint="'+z+'"] {}',l.sheet.cssRules.length);t=e.$$paintRule=l.sheet.cssRules[c];break}o=o.parentNode}return t}function V(e){var t=e.cssText;if(t)return t;t="";for(var n,r=0;r<e.length;r++)0!==r&&(t+=" "),t+=n=e[r],t+=":",t+=e.getPropertyValue(n),t+=";";return t}function U(e){var t=getComputedStyle(e);if(e.$$paintObservedProperties)for(var n=0;n<e.$$paintObservedProperties.length;n++){var r=e.$$paintObservedProperties[n];if(t.getPropertyValue(r).trim()!==e.$$paintedPropertyValues[r].trim()){H(e,t);break}}else if(e.$$paintId||u.test(V(t)))return void H(e,t);e.$$paintPending=!1}var q={get:function(e){return e in N?N[e]:N[e]=O.getPropertyValue(e)}},z=0;function H(e,t){var n=o,r=!document.contains(e);if(r)for(var i=e;i;){if(!i.parentNode){n=i;break}i=i.parentNode}a.disabled=!0;var s,l=O=null==t?getComputedStyle(e):t;N={};var c=[];e.$$paintPending=!1;for(var u={width:e.clientWidth,height:e.clientHeight},h=g(),f=e.$$paintedProperties,v=0;v<l.length;v++){var m=l[v],b=q.get(m),$=/(,|\b|^)url\((['"]?)((?:-moz-element\(#|-webkit-canvas\()paint-\d+-([^;,]+)\)|(?:data:image\/paint-|blob:[^'"#]+#paint=)([^"';, ]+)(?:[;,].*?)?)\2\)(;|,|\s|\b|$)/g,P="",S=0,x=[],R=!1,C=!1,k=void 0,T=void 0,E=u;if(/border-image/.test(m)){var L=E.width,I=E.height,j=_(q.get("border-image-slice").replace(/\sfill/,"").split(" "));L-=F(L,j.left)+F(L,j.right),I-=F(I,j.top)+F(I,j.bottom);var V=_(q.get("border-image-outset").split(" "));E={width:L=F(F(L,V.left),V.right),height:I=F(F(I,V.top),V.bottom)}}for(;T=$.exec(b);){!1===C&&(k=A(e)),C=!0,P+=b.substring(0,T.index);var U=T[4]||T[5],z=T[3],H=y[U],G=H&&H.Painter.contextOptions||{},X=!1===G.scaling?1:h,J=void 0;H&&(H.Painter.inputProperties&&c.push.apply(c,H.Painter.inputProperties),J=w(H)),!0===G.nativePixels&&(E.width*=h,E.height*=h,X=1);var K=X*E.width,Q=X*E.height,Y=e.$$paintContext,Z="paint-"+k+"-"+U;if(Y&&Y.canvas&&Y.canvas.width==K&&Y.canvas.height==Q)Y.clearRect(0,0,K,Q);else{if(!0===p)Y=(r?n:document).getCSSCanvasContext("2d",Z,K,Q);else{var ee=document.createElement("canvas");ee.id=Z,ee.width=K,ee.height=Q,!0===d&&(ee.style.display="none",n.appendChild(ee)),Y=ee.getContext("2d")}e.$$paintContext=Y,Y.imageSmoothingEnabled=!1,1!==X&&Y.scale(X,X)}if(J&&(Y.save(),Y.beginPath(),J.paint(Y,E,q),Y.closePath(),Y.restore(),!1===p&&"resetTransform"in Y&&Y.resetTransform()),P+=T[1],!0===p)P+="-webkit-canvas("+Z+")",R=null==T[4];else if(!0===d)P+="-moz-element(#"+Z+")",R=null==T[4];else{var te=Y.canvas.toDataURL("image/png").replace("/png","/paint-"+U);if("function"==typeof MSBlobBuilder&&(te=W(te,U)),x.push(te),P+='url("'+te+'")',te!==z||!s){var ne=z?z.indexOf("#"):-1;~ne&&URL.revokeObjectURL(z.substring(0,ne)),R=!0}z=te}P+=T[6],S=T.index+T[0].length}!1!==C||null==f||null==f[m]?(P+=b.substring(S),R&&(s||(s=M(e)),null==f&&(f=e.$$paintedProperties={}),f[m]=!0,"background"===m.substring(0,10)&&1!==h&&B(s.style,"background-size",E.width+"px "+E.height+"px"),0===x.length?B(s.style,m,P):D(x,B,[s.style,m,P]))):(s||(s=M(e)),s.style.removeProperty(m))}e.$$paintObservedProperties=0===c.length?null:c;for(var re=e.$$paintedPropertyValues={},ie=0;ie<c.length;ie++){var oe=c[ie];re[oe]=q.get(oe)}a.disabled=!1}function W(e,t){for(var n=atob(e.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return URL.createObjectURL(new Blob([r]))+"#paint="+t}function B(e,t,n){e.setProperty(t,n,"important")}function F(e,t){var n=parseFloat(t);return t?t.match("px")?e+n:(t.match("%")&&(n/=100),e*n):e}function _(e){return{top:e[0],bottom:e[2]||e[0],left:e[3]||e[1]||e[0],right:e[1]||e[0]}}var G=function(){var i=a.prototype;function a(){var e=this;this.mutLock=!1,v(x);var t=document.createElement("x-a");document.body.appendChild(t);var i=!1;this.mut=new MutationObserver(function(n){if(!0!==e.mutLock){e.mutLock=!0;for(var r=0;r<n.length;r++){var o=n[r],a=void 0;if("childList"===o.type&&(a=o.addedNodes))for(var s=0;s<a.length;s++)1===a[s].nodeType&&I(a[s]);else"attributes"===o.type&&1===o.target.nodeType&&(o.target===t?i=!0:S(o.target,I))}e.mutLock=!1}}),Object.defineProperty(Element.prototype,"attachShadow",{value:function(e){var t=f.call(this,e);return r._observerShadow(t),t}}),this.mut.observe(document.body,{childList:!0,attributes:!0,subtree:!0}),t.style.cssText="color: red;",setTimeout(function(){if(document.body.removeChild(t),!i){var e=Object.getOwnPropertyDescriptor(HTMLElement.prototype,"style"),r=e.get;e.get=function(){var e=r.call(this);return e.ownerElement=this,e},n(HTMLElement.prototype,"style",e);var o=Object.getOwnPropertyDescriptor(CSSStyleDeclaration.prototype,"cssText"),a=o.set;o.set=function(e){return this.ownerElement&&I(this.ownerElement),a.call(this,e)},n(CSSStyleDeclaration.prototype,"cssText",o);var s=Object.getOwnPropertyDescriptor(CSSStyleDeclaration.prototype,"setProperty"),l=s.value;s.value=function(e,t,n){this.ownerElement&&I(this.ownerElement),l.call(this,e,t,n)},n(CSSStyleDeclaration.prototype,"setProperty",s)}})}return i._observerShadow=function(e){this.mut.observe(e,{childList:!0,attributes:!0,subtree:!0})},i.addModule=function(r){var i,a,s=this;return h&&(i=new Promise(function(e){return a=e})),t(r,function(t){var r={registerPaint:function(e,t){!function(e,t,n){y[e]={worklet:n,Painter:t,properties:t.inputProperties?[].slice.call(t.inputProperties):[],bit:0,instances:[]},x()}(e,t,{context:r,realm:i})}};n(r,"devicePixelRatio",{get:g}),r.self=r;var i=new e(r,o);t=(s.transpile||String)(t),i.exec(t),a&&a()}),i},a}()}();
//# sourceMappingURL=css-paint-polyfill.js.map
